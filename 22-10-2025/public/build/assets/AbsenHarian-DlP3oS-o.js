import{a as m,j as a,r as d}from"./app-D5LrGWPf.js";import{d as T}from"./dayjs.min-B8dRGMdY.js";import{y as x}from"./index-_iQ4wFyz.js";const y=(e,s)=>{console.error("API Error:",e.response?.data||e.message);const i=e.response?.data?.message||(e.response?.data?.errors?Object.values(e.response?.data?.errors).flat().join(", "):s);throw x.error(i),e},p={getAbsenHarian:async(e=null,s=null)=>{try{const i={};return e&&(i.tanggal=e),s&&(i.status=s),(await m.get("/absensi/harian",{params:i})).data}catch(i){y(i,"Gagal memuat data absensi harian")}},storeAbsenHarian:async e=>(await m.post("/absensi/harian",{data:e},{headers:{"Content-Type":"application/json"}})).data,getStatusAbsen:async()=>{try{const e=await m.get("/absensi/status-absen");return Array.isArray(e.data?.data)?e.data.data:Array.isArray(e.data)?e.data:[]}catch(e){return y(e,"Gagal memuat daftar status absen"),[]}},getKaryawan:async()=>{try{const e=await m.get("/absensi/karyawan");return Array.isArray(e.data?.data)?e.data.data:Array.isArray(e.data)?e.data:[]}catch(e){return y(e,"Gagal memuat daftar karyawan"),[]}},getBagian:async()=>{try{const e=await m.get("/absensi/bagian");return Array.isArray(e.data?.data)?e.data.data:Array.isArray(e.data)?e.data:[]}catch(e){return y(e,"Gagal memuat daftar bagian"),[]}},getSubBagian:async e=>{if(!e)return[];try{const s=await m.get("/absensi/subbagian",{params:{bagian:e}});return Array.isArray(s.data?.data)?s.data.data:Array.isArray(s.data)?s.data:[]}catch(s){return y(s,"Gagal memuat daftar subbagian"),[]}}},Y=({index:e,row:s,bagianOptions:i,statusOptions:o,karyawanList:j,onChange:h,onSelectBagian:f,onSelectSubBagian:w,onSelectKaryawan:N,onRemove:A})=>{const v=s.subbagian?j.filter(t=>t.sub_bagian===s.subbagian):[];return a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-2 items-end",children:[a.jsx("input",{type:"date",value:s.tanggal,onChange:t=>h(e,"tanggal",t.target.value),className:"border rounded-lg p-2 w-full text-sm"}),a.jsxs("select",{value:s.bagian,onChange:t=>f(e,t.target.value),className:"border rounded-lg p-2 w-full text-sm",children:[a.jsx("option",{value:"",children:"Pilih Bagian"}),i.map((t,u)=>a.jsx("option",{value:t,children:t},u))]}),a.jsxs("select",{value:s.subbagian,onChange:t=>w(e,t.target.value),className:"border rounded-lg p-2 w-full text-sm",children:[a.jsx("option",{value:"",children:"Pilih Subbagian"}),s.subbagianOptions.map((t,u)=>a.jsx("option",{value:t,children:t},u))]}),a.jsxs("select",{value:s.nama,onChange:t=>N(e,t.target.value),className:"border rounded-lg p-2 w-full text-sm",disabled:!s.subbagian,children:[a.jsx("option",{value:"",children:"Pilih Karyawan"}),v.map(t=>a.jsx("option",{value:t.nama,children:t.nama},t.id))]}),a.jsxs("select",{value:s.kode_absen,onChange:t=>h(e,"kode_absen",t.target.value),className:"border rounded-lg p-2 w-full text-sm",required:!0,children:[a.jsx("option",{value:"",children:"Pilih Status"}),o.map(t=>a.jsxs("option",{value:t.kode,children:[t.kode," â€” ",t.nama]},t.id))]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("input",{type:"text",placeholder:"Catatan",value:s.catatan,onChange:t=>h(e,"catatan",t.target.value),className:"border rounded-lg p-2 w-full text-sm"}),A&&a.jsx("button",{type:"button",onClick:()=>A(e),className:"bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600 text-xs",children:"Hapus"})]})]})},I=({loading:e,absenList:s})=>a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"w-full border-collapse border border-gray-200 text-sm",children:[a.jsx("thead",{children:a.jsxs("tr",{className:"bg-gray-100 text-xs",children:[a.jsx("th",{className:"border p-2",children:"No"}),a.jsx("th",{className:"border p-2",children:"Tanggal"}),a.jsx("th",{className:"border p-2",children:"Bagian"}),a.jsx("th",{className:"border p-2",children:"Subbagian"}),a.jsx("th",{className:"border p-2",children:"Nama"}),a.jsx("th",{className:"border p-2",children:"Status"}),a.jsx("th",{className:"border p-2",children:"Catatan"})]})}),a.jsx("tbody",{children:e?a.jsx("tr",{children:a.jsx("td",{colSpan:"7",className:"p-3 text-center text-gray-400 italic",children:"Memuat data..."})}):s.length>0?s.map((i,o)=>a.jsxs("tr",{children:[a.jsx("td",{className:"border p-2 text-center",children:o+1}),a.jsx("td",{className:"border p-2",children:i.tanggal}),a.jsx("td",{className:"border p-2",children:i.bagian}),a.jsx("td",{className:"border p-2",children:i.subbagian}),a.jsx("td",{className:"border p-2",children:i.nama}),a.jsx("td",{className:"border p-2 text-center",children:i.kode_absen}),a.jsx("td",{className:"border p-2",children:i.catatan})]},o)):a.jsx("tr",{children:a.jsx("td",{colSpan:"7",className:"p-3 text-center text-gray-400 italic",children:"Belum ada data absensi"})})})]})}),J=()=>{const e=()=>({tanggal:T().format("YYYY-MM-DD"),bagian:"",subbagian:"",subbagianOptions:[],nama:"",kode_absen:"",catatan:""}),[s,i]=d.useState([e()]),[o,j]=d.useState([]),[h,f]=d.useState([]),[w,N]=d.useState([]),[A,v]=d.useState([]),[t,u]=d.useState(!1),[B,k]=d.useState(!1);d.useEffect(()=>{C(),H(),O(),_()},[]);const C=async()=>{u(!0);try{const n=await p.getAbsenHarian(),l=Array.isArray(n.data?.data)?n.data.data:Array.isArray(n.data)?n.data:[];j(l)}catch{j([])}finally{u(!1)}},H=async()=>{try{const n=await p.getStatusAbsen();f(n)}catch{f([])}},O=async()=>{try{const n=await p.getKaryawan();N(n)}catch{N([])}},_=async()=>{try{const n=await p.getBagian();v(n)}catch{v([])}},R=async n=>{if(!n)return[];try{const l=await p.getSubBagian(n);return Array.isArray(l)?l.map(r=>typeof r=="string"?r:r.nama||""):[]}catch{return[]}},S=(n,l,r)=>{i(c=>c.map((b,g)=>g===n?{...b,[l]:r}:b))},K=async(n,l)=>{const r=await R(l);i(c=>c.map((b,g)=>g===n?{...b,bagian:l,subbagian:"",subbagianOptions:r,nama:"",kode_absen:""}:b))},G=(n,l)=>{S(n,"subbagian",l)},D=async(n,l)=>{const r=w.find(c=>c.nama===l);if(r){let c=[];r.bagian&&(c=await R(r.bagian)),i(b=>b.map((g,L)=>L===n?{...g,nama:r.nama,bagian:r.bagian||"",subbagian:r.sub_bagian||"",subbagianOptions:c}:g))}else S(n,"nama",l)},E=()=>i(n=>[...n,e()]),M=n=>i(l=>l.filter((r,c)=>c!==n)),P=async n=>{if(n.preventDefault(),s.filter(r=>!r.nama||!r.kode_absen).length>0){x.warning("Nama dan status absen wajib diisi di setiap baris!");return}k(!0);try{const r=await p.storeAbsenHarian(s);r.success?(x.success(r.message||"Data absensi berhasil disimpan"),i([e()]),C()):x.error(r.message||"Gagal menyimpan data absensi")}catch(r){const c=r.response?.data?.message||r.message||"Gagal menyimpan data";x.error(c)}finally{k(!1)}};return a.jsxs("div",{className:"p-4 space-y-6",children:[a.jsxs("div",{className:"bg-white shadow-md rounded-lg p-4",children:[a.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Input Absen Harian (Multiple Rows)"}),a.jsxs("form",{onSubmit:P,className:"space-y-3 text-sm",children:[s.map((n,l)=>a.jsx(Y,{index:l,row:n,bagianOptions:A,statusOptions:h,karyawanList:w,onChange:S,onSelectBagian:K,onSelectSubBagian:G,onSelectKaryawan:D,onRemove:s.length>1?M:null},l)),a.jsxs("div",{className:"flex gap-2 pt-2",children:[a.jsx("button",{type:"button",onClick:E,className:"bg-green-500 text-white px-3 py-2 rounded hover:bg-green-600 text-sm",children:"Tambah Baris"}),a.jsx("button",{type:"submit",disabled:B,className:"bg-blue-600 text-white px-3 py-2 rounded hover:bg-blue-700 text-sm",children:B?"Menyimpan...":"Simpan Semua"})]})]})]}),a.jsxs("div",{className:"bg-white shadow-md rounded-lg p-4 text-sm",children:[a.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Data Absen Harian"}),a.jsx(I,{loading:t,absenList:o})]})]})};export{J as default};
