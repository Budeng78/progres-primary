import{k,u as E,r as l,j as e}from"./app-D5LrGWPf.js";import{y as i}from"./index-_iQ4wFyz.js";import{d as c}from"./dayjs.min-B8dRGMdY.js";import{k as w}from"./karyawan-XnhpqS-l.js";const C=()=>{const{id:d}=k(),x=E(),[s,m]=l.useState({}),[u,f]=l.useState(!0),[g,p]=l.useState(null),[b,h]=l.useState({}),y=a=>a?c().diff(c(a),"year"):null,j=a=>a?c().diff(c(a),"year"):null;l.useEffect(()=>{(async()=>{try{const t=await w.getById(d);if(m(t),t?.foto_formal){const r=t.foto_formal.startsWith("http")?t.foto_formal:`${window.location.origin}/storage/${t.foto_formal}`;p(r)}}catch{i.error("Gagal memuat data karyawan")}finally{f(!1)}})()},[d]);const v=a=>{const{name:t,value:r}=a.target;m(n=>({...n,[t]:r}))},N=a=>{const t=a.target.files[0];t&&(m(r=>({...r,foto_formal:t})),p(URL.createObjectURL(t)))},_=async a=>{a.preventDefault(),h({}),f(!0);try{const t=new FormData;Object.entries(s).forEach(([n,o])=>{o!=null&&n!=="umur"&&n!=="masa_kerja"&&t.append(n,o)}),(await w.update(d,t)).success&&(i.success("Data karyawan berhasil diperbarui"),x("/karyawan/list"))}catch(t){const r=t.response?.data?.errors||{};h(r),Object.keys(r).length?Object.entries(r).forEach(([n,o])=>i.error(`${n}: ${o[0]}`)):i.error("Gagal memperbarui data karyawan")}finally{f(!1)}};return u?e.jsx("div",{className:"p-4 text-gray-600",children:"Memuat data..."}):e.jsxs("div",{className:"max-w-5xl mx-auto bg-white rounded-xl shadow-lg p-6",children:[e.jsx("h1",{className:"text-2xl font-semibold mb-6 text-center text-blue-700",children:"Edit Data Karyawan"}),e.jsxs("div",{className:"col-span-2 flex flex-col items-center mb-8",children:[g&&e.jsx("img",{src:g,alt:"Preview Foto",className:"w-[151px] h-[227px] object-cover rounded-lg border shadow mb-4"}),e.jsx("input",{type:"file",name:"foto_formal",accept:"image/*",capture:"environment",onChange:N,className:"border rounded-lg px-3 py-2 w-full max-w-sm text-sm"}),e.jsxs("p",{className:"mt-4 font-medium text-gray-700",children:["Foto Formal - ",s.nama||"-"]})]}),e.jsxs("form",{onSubmit:_,className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[Object.entries(s).map(([a,t])=>["foto_formal","umur","masa_kerja","id"].includes(a)?null:e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium text-gray-700 mb-1",children:a.replace(/_/g," ").toUpperCase()}),e.jsx("input",{type:"text",name:a,value:t||"",onChange:v,className:"w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"}),b[a]&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:b[a][0]})]},a)),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium text-gray-700 mb-1",children:"Umur"}),e.jsx("input",{type:"text",readOnly:!0,value:y(s.tanggal_lahir)?`${y(s.tanggal_lahir)} tahun`:"-",className:"w-full border rounded-lg px-3 py-2 bg-gray-100 text-gray-700"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium text-gray-700 mb-1",children:"Masa Kerja"}),e.jsx("input",{type:"text",readOnly:!0,value:j(s.masuk_kerja)?`${j(s.masuk_kerja)} tahun`:"-",className:"w-full border rounded-lg px-3 py-2 bg-gray-100 text-gray-700"})]}),e.jsxs("div",{className:"col-span-2 flex justify-between gap-4",children:[e.jsx("button",{type:"button",onClick:()=>x("/karyawan/list"),className:"w-1/2 py-3 bg-gray-500 hover:bg-gray-600 text-white font-semibold rounded-lg transition duration-200",children:"Kembali"}),e.jsx("button",{type:"submit",disabled:u,className:"w-1/2 py-3 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition duration-200",children:u?"Menyimpan...":"Simpan Perubahan"})]})]})]})};export{C as default};
