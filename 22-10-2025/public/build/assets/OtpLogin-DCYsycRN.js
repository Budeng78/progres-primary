import{a as i,r,A as j,j as e}from"./app-D5LrGWPf.js";const b={sendOtp:a=>i.post("/otp/send",a).then(n=>n.data),verifyOtp:a=>i.post("/otp/verify",a).then(n=>n.data),resetPassword:a=>i.post("/otp/reset-password",a).then(n=>n.data)},v=()=>{const{user:a,login:n,logout:f}=r.useContext(j),[u,m]=r.useState(""),[d,h]=r.useState(""),[p,g]=r.useState(""),[l,x]=r.useState(!1),[c,o]=r.useState("");r.useEffect(()=>{const s=localStorage.getItem("authToken");s?(i.defaults.headers.common.Authorization=`Bearer ${s}`,console.log("✅ Axios setup — token diset:",s)):console.warn("⚠️ Token saat fetch user: null")},[]);const k=async s=>{s.preventDefault(),o("");try{const t=await b.sendOtp({name:u,whatsapp_number:d});o(t.message||"Kode OTP berhasil dikirim ke WhatsApp Anda."),x(!0)}catch(t){console.error(t),o(t.message||"Gagal mengirim OTP. Periksa koneksi Anda.")}},w=async s=>{s.preventDefault(),o("");try{const t=await b.verifyOtp({whatsapp_number:d,otp_code:p});if(!t||!t.user||!t.token)throw new Error("Respons tidak valid dari server.");localStorage.setItem("user",JSON.stringify(t.user)),localStorage.setItem("authToken",t.token),i.defaults.headers.common.Authorization=`Bearer ${t.token}`,n(t.user,t.token),o("Login berhasil! Mengalihkan..."),setTimeout(()=>{window.location.href="/"},1e3)}catch(t){console.error(t),o(t.message||"Kode OTP salah atau kedaluwarsa.")}},y=()=>{f(),x(!1),g(""),h(""),m(""),o("Anda telah logout.")};return a?e.jsx("div",{className:"flex flex-col items-center justify-center min-h-screen bg-gray-100",children:e.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-md w-96 text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-green-600 mb-4",children:"Anda Sudah Login!"}),e.jsxs("p",{className:"text-gray-600 mb-6",children:["Selamat datang kembali, ",a.name]}),e.jsx("button",{onClick:y,className:"w-full py-2 px-4 bg-red-600 text-white font-bold rounded-md hover:bg-red-700 transition duration-300",children:"Logout"})]})}):e.jsx("div",{className:"flex flex-col items-center justify-center min-h-screen bg-gray-100",children:e.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-md w-96",children:[e.jsx("h1",{className:"text-2xl font-bold text-center mb-6",children:"Login dengan OTP"}),e.jsxs("form",{onSubmit:l?w:k,children:[!l&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 font-semibold mb-2",children:"Nama"}),e.jsx("input",{type:"text",value:u,onChange:s=>m(s.target.value),placeholder:"Masukkan nama Anda",required:!0,className:"w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 font-semibold mb-2",children:"Nomor WhatsApp"}),e.jsx("input",{type:"tel",value:d,onChange:s=>h(s.target.value),placeholder:"081234567890",required:!0,className:"w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),l&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 font-semibold mb-2",children:"Kode OTP"}),e.jsx("input",{type:"text",value:p,onChange:s=>g(s.target.value),placeholder:"Masukkan 6 digit kode OTP",maxLength:6,required:!0,className:"w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-green-500"})]}),e.jsx("button",{type:"submit",className:`w-full py-2 px-4 text-white font-bold rounded-md transition duration-300 ${l?"bg-green-600 hover:bg-green-700":"bg-blue-600 hover:bg-blue-700"}`,children:l?"Verifikasi OTP":"Kirim OTP"})]}),c&&e.jsx("p",{className:`mt-4 text-center text-sm font-semibold ${c.toLowerCase().includes("berhasil")?"text-green-600":"text-red-600"}`,children:c})]})})};export{v as default};
